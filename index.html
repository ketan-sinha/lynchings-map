<!DOCTYPE html>
<html>
  <head>
    <style>
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #map {
        height: 100%;
      }
      /* Optional: Makes the sample page fill the window. */
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCpQbnnUBIaxaB41kCOZWcCEeY6ghoivBA"></script>
    <script src="bin/oms.min.js"></script>
    <script>
      var map;
      map = new google.maps.Map(document.getElementById('map'), {
        zoom: 5,
        center: new google.maps.LatLng(37.09024, -100.712891), //roughly the center of the United States
        mapTypeId: 'roadmap',
        styles: [{"featureType":"all","elementType":"labels.text.fill","stylers":[{"saturation":36},{"color":"#000000"},{"lightness":40}]},{"featureType":"all","elementType":"labels.text.stroke","stylers":[{"visibility":"on"},{"color":"#000000"},{"lightness":16}]},{"featureType":"all","elementType":"labels.icon","stylers":[{"visibility":"off"}]},{"featureType":"administrative","elementType":"geometry.fill","stylers":[{"color":"#000000"},{"lightness":20}]},{"featureType":"administrative","elementType":"geometry.stroke","stylers":[{"color":"#000000"},{"lightness":17},{"weight":1.2}]},{"featureType":"landscape","elementType":"geometry","stylers":[{"color":"#000000"},{"lightness":20}]},{"featureType":"poi","elementType":"geometry","stylers":[{"color":"#000000"},{"lightness":21}]},{"featureType":"road.highway","elementType":"geometry.fill","stylers":[{"color":"#000000"},{"lightness":17}]},{"featureType":"road.highway","elementType":"geometry.stroke","stylers":[{"color":"#000000"},{"lightness":29},{"weight":0.2}]},{"featureType":"road.arterial","elementType":"geometry","stylers":[{"color":"#000000"},{"lightness":18}]},{"featureType":"road.local","elementType":"geometry","stylers":[{"color":"#000000"},{"lightness":16}]},{"featureType":"transit","elementType":"geometry","stylers":[{"color":"#000000"},{"lightness":19}]},{"featureType":"water","elementType":"geometry","stylers":[{"color":"#000000"},{"lightness":17}]}]
      });

      var script = document.createElement('script');
      // TUses JSON db of lynchings
      script.src = 'lynchings.js';
      document.getElementsByTagName('head')[0].appendChild(script);

      var iw = new google.maps.InfoWindow();
      var oms = new OverlappingMarkerSpiderfier(map, {keepSpiderfied: true, nearbyDistance: 100});

      oms.addListener('click', function(marker){
        iw.setContent(marker.desc);
        iw.open(map, marker);
      });
      // Loop through the results array and place a marker for each
      // set of coordinates.
      window.eqfeed_callback = function(results) {
        for (var i = 0; i < results.features.length; i++) {
          var iconURL;
          var coords = results.features[i].geometry.coordinates;
          var latLng = new google.maps.LatLng(coords[1],coords[0]);
          var marker = new google.maps.Marker({
            icon: iconURL,
            position: latLng,
            map: map,
            year: results.features[i].properties.Year,
            desc: '<div id="content">'+
            '<div id="siteNotice">'+
            '</div>'+
            '<h1 id="firstHeading" class="firstHeading">'+ results.features[i].properties.Name +'</h1>'+
            '<div id="bodyContent">'+
            '<p><i>'+ results.features[i].properties.Race + ' ' +
                      results.features[i].properties.Gender + ' ' +
                      results.features[i].properties.Age + '</i><p>' +
            '<p><b>'+ results.features[i].properties.Year + '/' +
                      results.features[i].properties.Month + '/' +
                      results.features[i].properties.Day + '</b></p>' +
            '<p><i>Accusation:</i> ' + results.features[i].properties.Accusation + '</p>' +
            '<p><i>Death:</i> ' + results.features[i].properties["Method of Death"] + '</p>' +
            '</div>'+
            '</div>'
          });
          if(results.features[i].properties.Race.search("Black") !== -1){
            marker.setIcon('img/yellow_button.png');
          }
          else if(results.features[i].properties.Race.search("White") !== -1){
            marker.setIcon('img/red_button.png');
          }
          oms.addMarker(marker);
        }

      }
    </script>

  </body>
</html>
